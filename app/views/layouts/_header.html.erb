<div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container">
      <a class="brand" href="/"><img src="/images/swapidy_logo.png" style="height:50px"></a>
      <ul class="nav pull-left">
        <li>
          <%= render :partial => "/layouts/locations" %>
        </li>
      </ul>

      <ul class="nav pull-right nav_header" role="navigation" style="margin-right: -160px;">

        <% if user_signed_in? %>
        <% if current_user.free_honey_sendable? %>
          <li id="nav_login">
            <a href="javascript:refresh_free_honey_form();" >GET FREE HONEY</a>
          </li>
          <li class="divider-vertical"></li>
        <% end %>
        <li class="dropdown" id="notification_menu" >
          <%= render :partial => "/layouts/notifications_menu" %>
        </li>
        <script language="JavaScript">
          $('#notification_menu ul li .notification_remove_icon').live("click", function() {
            var id = $(this).attr("notification-data");
            $.ajax({
              type : 'PUT',
              beforeSend : function(xhr) {
                xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))
              },
              url : '/notifications/' + id + '/hide',
              dataType : 'script'
            });
            return false;
          });
          $('#notification_menu ul li .notification_title').live("click", function() {
            var url = $(this).attr("notification-data");
            window.location = url;
            return false;
          });
          $('#notification_menu ul li .clear_all').live("click", function() {
            $.ajax({
              type : 'PUT',
              beforeSend : function(xhr) {
                xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))
              },
              url : '/notifications/all/hide',
              dataType : 'script'
            });
            return false;
          });

          setInterval(function() {
            $.ajax({
              type : 'PUT',
              beforeSend : function(xhr) {
                xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))
              },
              url : '/notifications/refresh',
              dataType : 'script'
            });
          }, 10 * 60 * 1000);

          <% if display_guide? %>display_guide();<% end %>
        </script>

        <%= render :partial => "/layouts/profile_menu" %>

        <li class="dropdown">
          <a id="dropdown_profile_icon" href="#" role="button" class="dropdown-toggle" data-toggle="dropdown"> <img class="nav_icons nav_settings" src="/images/settings_icon.png"></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdown_profile_icon">
            <li>
              <a tabindex="-1" href="/users/edit">ACCOUNT SETTINGS</a>
            </li>
            <li>
              <%= link_to('LOG OUT', destroy_user_session_path, :method => :delete) %>
            </li>
          </ul>
        </li>
        <li class="divider-vertical"></li>
        <li>
          <div class="honey_display">
            <div style="display: inline-block;"><img src="/images/honey_currency_score.png"><span id="honey_balance_amount_menu"><%= format_num(current_user.honey_balance)%></span>
              <% if controller_name != "payments" %>
              <div style="display: inline-block;">
                <a href="javascript:refresh_add_honey_form();"><img class="honey_currency_plus" src="/images/honey_currency_plus.png"></a>
              </div>
              <% else %>
              <div style="display: inline-block;">
                <a href="/payments/new"><img class="honey_currency_plus" src="/images/honey_currency_plus.png"></a>
              </div>
              <% end %>
            </div>
        </li>
        <li>
          <div class="help">
            <a href="javascript:showPopup('popup-dialog_help');" >
            <div style="display: inline-block;">
             Questions? &nbsp;<img class="help_icon" src="/images/help.png">
            </a>
          </div>
        </li>
        <% if current_user.is_admin? %>
        <li>
          <%= link_to('ADMIN', rails_admin_path, :method => :get) %>
        </li>

        <% end %>

        <% else %>
        <li id="nav_login">
          <a href="javascript:refresh_signin_form();" >LOG IN</a>
        </li>
        <li class="divider-vertical"></li>
        <li id="nav_signup">
          <a href="javascript:refresh_signup_form();" >SIGN UP</a>
        </li>
                        <li class="divider-vertical"></li>

        <li>
          <a href="javascript:showPopup('popup-dialog_what');" >WHAT IS&nbsp; <img src="/images/navbar_honey.png" style="position:relative; bottom:3px;">&nbsp;?</a>
        </li> 
                <li class="divider-vertical"></li>

        <% end %>
        <li>
          <a href="javascript:refresh_how_it_works();">HOW IT WORKS</a>
        </li>
      </ul>
    </div>
  </div>
</div>

<% if user_signed_in? %>
<div>
  <strong>Signed in as <%= current_user.first_name %></strong>
</div>
<% if current_user.free_honey_sendable? %>
<div id="popup-dialog_for_free_honey" style="display:none;" class="popup-box-wrapper standard-popup">
  <div id="dialog-content">
    <%= render :partial => "/free_honeys/new" %>
  </div>
  <script language="JavaScript">

    function submitAddHoney() {
      $.ajax({
        type : 'POST',
        url : $("#popup-dialog_for_free_honey #add_honey").attr("action"),
        data : $("#popup-dialog_for_free_honey #add_honey").serialize(),
        dataType : 'script',
        success : function(data) {
        }
      });
    }

    function refresh_free_honey_form() {
      $('#popup-dialog_for_free_honey #email').attr('value', '');
      $('#popup-dialog_for_free_honey .alert-error').hide();
      $('#popup-dialog_for_free_honey .alert-success').hide();
      showPopup('popup-dialog_for_free_honey');
    }
  </script>
</div>
<% end %>
<% else %>
<div id="popup-dialog_for_signup" style="display:none; width: 0px; padding: 0px;" class="popup-box-wrapper standard-popup">
  <div id="dialog-content">
    <%= render :partial => "/devise/shared/signup_form", :locals => {:resource => User.new, :resource_name => "user", :show_cancel_link => true} %>
  </div>
</div>

<div id="popup-dialog_for_signin" style="display:none; width: 0px; padding: 0px;" class="popup-box-wrapper standard-popup">
  <div id="dialog-content">
    <%= render :partial => "/devise/shared/signin_form", :locals => {:resource => User.new, :resource_name => "user", :show_cancel_link => true} %>
  </div>
</div>
<% end %>
<div id="popup-box-bg" style="display: none;"></div>

<div id="popup-dialog_how_it_work" style="display:none; width: 0px; padding: 0px;" class="popup-box-wrapper standard-popup">
  <div id="dialog-content">
    <div class="container" style="background:url('/images/popup-bg.png') repeat; border-radius: 10px; padding: 30px 30px; position:fixed; top:20px;" >
      <a class="close-popup" onclick="hidePopup();" href="#" title="Cancel">Cancel</a>
      <%= render :partial => "/home/how_it_works" %>
    </div>
  </div>
</div>

<div id="popup-dialog_what" style="display:none; width: 300px; padding: 0px;" class="popup-box-wrapper standard-popup">
  <div id="dialog-content">
    <div class="container" style=" width: 500px;background:url('/images/popup-bg.png') repeat; border-radius: 10px; padding: 30px 30px; position:fixed; top:60px; margin-left:230px;" >
      <a class="close-popup" onclick="hidePopup();" href="#" title="Cancel">Cancel</a>
    <img class="what_honey" src="/images/what_honey.png">
    <div class="what_content"><div class="headings_pink" style="margin-left:30px;">The Honey virtual currency symbol.</div><br/> <span class="alert alert-success">$1 = 10 Honey.</span><br/><br/>Swapidy will give you Honey for your products and you can buy products with the Honey.</div>
    </div>
  </div>
</div>

<div id="popup-dialog_help" style="display:none; width:300px; padding: 0px;" class="popup-box-wrapper standard-popup">
  <div id="dialog-content">
    <div class="container" style="background:url('/images/popup-bg.png') repeat; border-radius: 10px; padding: 30px 30px; position:fixed; top:100px; line-height:1.5; text-align:center; width:500px; margin-left:260px;" >
            <a class="close-popup" onclick="hidePopup();" href="#" title="Cancel">Cancel</a>
    <div class="help_unit help_1">
      <img class="help_img"src="/images/icon_call.png"><br/><br/>
      Call Us Monday-Friday 9-9 PST:<br/> 1-(855)-SWAPIDY
    </div>  
    <div class="help_unit help_2">
      <a href="/contact_us"><img class="help_img" src="/images/icon_email.png"><br/><br/>
      Email Us</a>
    </div>
    </div>
  </div>
</div>
<% if current_user && controller_name != "payments" %>
  <div id="popup-dialog_add_honey" style="display:none; width:0px; padding: 0px;" class="popup-box-wrapper standard-popup">
    <div id="dialog-content">
      <div class="container" style="background:url('/images/popup-bg.png'); background-repeat:repeat; border-radius: 10px; padding: 40px; width:690px; margin-left:160px;" >
        <a class="close-popup" style="position:relative; left:10px;" onclick="hidePopup();" href="#" title="Cancel">Cancel</a>
        <%= render :partial => "/payments/new" %>
      </div>
    </div>
  </div>
<% end %>
<%= render :partial => "/layouts/orders.html" if current_user %>

<div id="page_loading_animation" style="display: none;">
  <div class="wrapper">
    <div class="inner">
      <span>L</span>
      <span>O</span>
      <span>A</span>
      <span>D</span>
      <span>I</span>
      <span>N</span>
      <span>G</span>
    </div>
  </div>
  <div class="underneath">
    <span>Please wait...</span>
  </div>
</div>

<script>
  function refresh_signin_form() {
    $('#popup-dialog_for_signin #prependedInput').attr('value', '');
    $('#popup-dialog_for_signin .alert-error').hide();
    showPopup('popup-dialog_for_signin');
  }

  function refresh_signup_form() {
    $('#popup-dialog_for_signup #prependedInput').attr('value', '');
    $('#popup-dialog_for_signup .alert-error').hide();
    showPopup('popup-dialog_for_signup');
  }
  function refresh_how_it_works() {
    $("#popup-dialog_how_it_work .hiw_steps").each(function(){
      $(this).hide();
    });
    showPopup('popup-dialog_how_it_work')
  }
  
</script>
